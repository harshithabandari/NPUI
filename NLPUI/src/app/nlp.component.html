<!-- File: src/app/components/completion/completion.component.html -->
<div class="completion-container">
  <!-- Header Section -->
  <header class="header">
    <h1>AI Text Completion</h1>
    <p class="subtitle">Ask any question and get AI-powered answers</p>
    <div class="info-badge">
      <span class="badge-icon">ü§ñ</span>
      <span class="badge-text">Powered by {{ getModelDisplayName(selectedModel) }}</span>
    </div>
  </header>

  <!-- Input Section -->
  <section class="input-section">
    <div class="form-group">
      <label for="question" class="required">Your Question</label>
      <textarea
        id="question"
        [(ngModel)]="question"
        placeholder="What would you like to know? Ask anything..."
        class="input-textarea"
        rows="3"
        [disabled]="isLoading"
        (keydown.ctrl.enter)="onSubmit()"
      ></textarea>
      <div class="input-hint">Press Ctrl+Enter to submit</div>
    </div>

    <div class="form-group">
      <label for="context">Context (Optional)</label>
      <textarea
        id="context"
        [(ngModel)]="context"
        placeholder="Provide additional context to help generate a better answer..."
        class="input-textarea"
        rows="4"
        [disabled]="isLoading"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="model">AI Model</label>
      <select
        id="model"
        [(ngModel)]="selectedModel"
        class="input-select"
        [disabled]="isLoading">
        <option *ngFor="let model of availableModels" [value]="model.id">
          {{ model.name }} ({{ model.provider }})
        </option>
      </select>
    </div>

    <!-- Advanced Options -->
    <div class="advanced-toggle">
      <button
        type="button"
        class="toggle-btn"
        (click)="toggleAdvancedOptions()"
        [disabled]="isLoading">
        <span>‚öôÔ∏è</span>
        {{ showAdvancedOptions ? 'Hide' : 'Show' }} Advanced Options
      </button>
    </div>

    <div class="advanced-options" *ngIf="showAdvancedOptions">
      <div class="options-grid">
        <div class="form-group">
          <label for="maxTokens">
            Max Tokens: {{ maxTokens }}
          </label>
          <input
            type="range"
            id="maxTokens"
            [(ngModel)]="maxTokens"
            min="50"
            max="2000"
            step="50"
            class="input-range"
            [disabled]="isLoading"
          />
          <div class="range-labels">
            <span>50</span>
            <span>2000</span>
          </div>
        </div>

        <div class="form-group">
          <label for="temperature">
            Temperature: {{ temperature }}
          </label>
          <input
            type="range"
            id="temperature"
            [(ngModel)]="temperature"
            min="0"
            max="1"
            step="0.1"
            class="input-range"
            [disabled]="isLoading"
          />
          <div class="range-labels">
            <span>0 (Precise)</span>
            <span>1 (Creative)</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
      <button
        (click)="onSubmit()"
        class="btn btn-primary"
        [disabled]="isLoading || !question.trim()">
        <span *ngIf="!isLoading">
          <span class="btn-icon">‚ú®</span>
          Generate Answer
        </span>
        <span *ngIf="isLoading">
          <span class="spinner-small"></span>
          Processing...
        </span>
      </button>

      <button
        (click)="onClear()"
        class="btn btn-secondary"
        [disabled]="isLoading"
        *ngIf="question || response">
        <span class="btn-icon">üóëÔ∏è</span>
        Clear
      </button>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span>{{ errorMessage }}</span>
    </div>
  </section>

  <!-- Loading Indicator -->
  <div class="loading-section" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p class="loading-text">AI is thinking...</p>
    <p class="loading-subtext">This may take a few moments</p>
  </div>
<div *ngIf="response">
  <h2>AI Response</h2>
  <div class="answer-text" [innerHTML]="getAnswer()"></div> <!-- For formatted (HTML) text -->

  <div class="meta-info">
    <p><strong>Model:</strong> {{ getModelName() }}</p>
    <p><strong>Finished Reason:</strong> {{ getFinishReason() }}</p>
    <p><strong>Answered On:</strong> {{ getTimestamp() }}</p>
    <p><strong>Token Usage:</strong> {{ getTokenUsage() }}</p>
  </div>
</div>
  <!-- Results Section -->
  <section class="results-section" *ngIf="response && !isLoading">
    <div class="results-header">
      <h2>Answer</h2>
      <button class="btn-icon-only" (click)="copyAnswer()" title="Copy answer">
        üìã
      </button>
    </div>

    <div class="answer-card">
      <div class="answer-text">
        {{ response.choices[0].text }}
      </div>
    </div>

    <!-- Metadata -->
    <div class="metadata-section">
      <div class="metadata-grid">
        <div class="metadata-item">
          <span class="metadata-label">Model</span>
          <span class="metadata-value">{{ getModelDisplayName(response.model) }}</span>
        </div>

        <div class="metadata-item">
          <span class="metadata-label">Response ID</span>
          <span class="metadata-value mono">{{ response.id }}</span>
        </div>

        <div class="metadata-item">
          <span class="metadata-label">Timestamp</span>
          <span class="metadata-value">{{ formatTimestamp(response.created) }}</span>
        </div>

        <div class="metadata-item">
          <span class="metadata-label">Finish Reason</span>
          <span class="metadata-value">{{ response.choices[0].finishReason }}</span>
        </div>
      </div>

      <!-- Token Usage -->
      <div class="usage-section">
        <h3>Token Usage</h3>
        <div class="usage-grid">
          <div class="usage-item">
            <span class="usage-label">Prompt</span>
            <span class="usage-value">{{ response.usage.promptTokens }}</span>
          </div>
          <div class="usage-item">
            <span class="usage-label">Completion</span>
            <span class="usage-value">{{ response.usage.completionTokens }}</span>
          </div>
          <div class="usage-item highlight">
            <span class="usage-label">Total</span>
            <span class="usage-value">{{ response.usage.totalTokens }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Empty State -->
  <section class="empty-state" *ngIf="!response && !isLoading && !errorMessage">
    <div class="empty-icon">üí¨</div>
    <h3>Ready to Answer</h3>
    <p>Enter your question above to get AI-powered answers</p>
    <div class="example-queries">
      <p><strong>Example questions:</strong></p>
      <ul>
        <li>"What is machine learning?"</li>
        <li>"Explain quantum computing in simple terms"</li>
        <li>"How does photosynthesis work?"</li>
        <li>"What are the benefits of renewable energy?"</li>
      </ul>
    </div>
  </section>
</div>
